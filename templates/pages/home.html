{% extends "base/base.html" %}

{% block title %}Accueil - Dashboard{% endblock %}

{% block content %}
<!-- En-tête moderne -->
<div class="row mb-5 fade-in">
    <div class="col-12 col-lg-10 mx-auto">
        <div class="text-center mb-4">
            <h1 class="mb-4" style="font-size: 3rem; font-weight: 800; letter-spacing: -0.03em;">
                Analyse des inégalités<br>de mobilité en France 
            </h1>
            <p class="lead" style="font-size: 1.25rem; max-width: 700px; margin: 0 auto;">
                Comparez les conditions de mobilité entre communes et zones, identifiez les zones mal desservies,
                et produisez des indicateurs pour appuyer vos décisions.
            </p>
        </div>
    </div>
</div>

<!-- Indicateurs clés (KPIs) - Design moderne -->
<section id="indicateurs" class="mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Indicateurs Clés</h2>
        <span class="text-muted" style="font-size: 0.875rem;">Vue d'ensemble nationale</span>
    </div>
    <div class="row g-4">
        <div class="col-lg-3 col-md-6 col-sm-6">
            <div class="kpi-card fade-in">
                <div class="kpi-label">Population sans accès transport</div>
                <div class="kpi-value">{{stats.pourcentage_sans_transport}}%</div>
                <div class="kpi-change positive">
                    <span style="font-size: 1rem;">↗</span>
                    <span>+0.3% vs moyenne nationale</span>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6">
            <div class="kpi-card fade-in">
                <div class="kpi-label">Temps moyen domicile-travail</div>
                <div class="kpi-value">{{stats.pourcentage_temps_moyen}} min</div>
                <div class="kpi-change negative">
                    <span style="font-size: 1rem;">↘</span>
                    <span>-2 min vs moyenne nationale</span>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6">
            <div class="kpi-card fade-in">
                <div class="kpi-label">Taux utilisation vélo</div>
                <div class="kpi-value">{{stats.pourcentage_velo}}%</div>
                <div class="kpi-change positive">
                    <span style="font-size: 1rem;">↗</span>
                    <span>+1.5% vs moyenne nationale</span>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6">
            <div class="kpi-card fade-in">
                <div class="kpi-label">Taux transports en commun</div>
                <div class="kpi-value">{{stats.pourcentage_transport_commun}}%</div>
                <div class="kpi-change positive">
                    <span style="font-size: 1rem;">↗</span>
                    <span>+5.2% vs moyenne nationale</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Cartes interactives -->
<section id="cartes" class="mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Cartes Interactives</h2>
        <span class="text-muted" style="font-size: 0.875rem;">Visualisations géographiques</span>
    </div>
    <div class="row g-4">
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0 d-flex align-items-center gap-2">
                        <svg class="fib-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <g opacity="0.2">
                                <line x1="20" y1="0" x2="20" y2="100" stroke="currentColor" stroke-width="0.5" />
                                <line x1="50" y1="0" x2="50" y2="100" stroke="currentColor" stroke-width="0.5" />
                                <line x1="80" y1="0" x2="80" y2="100" stroke="currentColor" stroke-width="0.5" />
                                <line x1="0" y1="20" x2="100" y2="20" stroke="currentColor" stroke-width="0.5" />
                                <line x1="0" y1="50" x2="100" y2="50" stroke="currentColor" stroke-width="0.5" />
                                <line x1="0" y1="80" x2="100" y2="80" stroke="currentColor" stroke-width="0.5" />
                            </g>
                            <circle cx="30" cy="30" r="3" fill="currentColor" />
                            <circle cx="50" cy="50" r="5" fill="currentColor" />
                            <circle cx="70" cy="70" r="2" fill="currentColor" />
                            <circle cx="20" cy="60" r="2" fill="currentColor" />
                            <circle cx="80" cy="30" r="2" fill="currentColor" />
                        </svg>
                        Localisation des Communes
                    </h5>
                </div>
                <div class="card-body">
                    <div class="placeholder-section">
                        <iframe src="{{ url_for('static', filename='map_communes.html') }}" width="100%" height="100%"
                            style="border:none; display: block;height: 300px;"
                            title="Carte de localisation des communes">
                        </iframe>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0 d-flex align-items-center gap-2">
                        <svg class="fib-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <path d="M 50 10 L 90 90 L 10 90 Z" fill="none" stroke="currentColor" stroke-width="3"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <circle cx="50" cy="60" r="3" fill="currentColor" />
                            <line x1="50" y1="70" x2="50" y2="85" stroke="currentColor" stroke-width="3"
                                stroke-linecap="round" />
                        </svg>
                        Zones Mal Desservies
                    </h5>
                </div>
                <div class="card-body">
                    <div class="placeholder-section">
                        <iframe src="{{ url_for('static', filename='map_zones_mal_desservies.html') }}" width="100%"
                            height="100%" style="border:none; display: block;height: 300px;"
                            title="Carte de localisation des communes">
                        </iframe>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0 d-flex align-items-center gap-2">
                        <svg class="fib-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M 50 50 A 5 5 0 0 1 55 50 A 8 8 0 0 1 55 42 A 13 13 0 0 1 68 42 A 21 21 0 0 1 68 21"
                                fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                opacity="0.8" />
                            <path
                                d="M 50 50 A 5 5 0 0 0 45 50 A 8 8 0 0 0 45 58 A 13 13 0 0 0 32 58 A 21 21 0 0 0 32 79"
                                fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                opacity="0.8" />
                            <circle cx="50" cy="50" r="4" fill="currentColor" />
                        </svg>
                        Indicateur Mobilité Verte
                    </h5>
                </div>
                <div class="card-body">
                    <div class="placeholder-section">
                        <iframe src="{{ url_for('static', filename='map_mobilite_verte.html') }}" width="100%"
                            height="100%" style="border:none; display: block;height: 300px;"
                            title="Carte de localisation des communes">
                        </iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Graphiques -->
<section id="graphiques" class="mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Graphiques et Analyses</h2>
        <span class="text-muted" style="font-size: 0.875rem;">Analyses statistiques</span>
    </div>
    <div class="row g-4">
        <div class="col-12">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0 d-flex align-items-center gap-2">
                        <svg class="fib-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <line x1="10" y1="90" x2="90" y2="90" stroke="currentColor" stroke-width="1.5"
                                opacity="0.3" />
                            <line x1="10" y1="90" x2="10" y2="10" stroke="currentColor" stroke-width="1.5"
                                opacity="0.3" />
                            <path d="M 15 85 Q 25 75, 35 70 T 55 55 T 75 40 T 85 25" fill="none" stroke="currentColor"
                                stroke-width="3" stroke-linecap="round" />
                            <circle cx="15" cy="85" r="2" fill="currentColor" />
                            <circle cx="35" cy="70" r="2.5" fill="currentColor" />
                            <circle cx="55" cy="55" r="3" fill="currentColor" />
                            <circle cx="75" cy="40" r="2.5" fill="currentColor" />
                            <circle cx="85" cy="25" r="2" fill="currentColor" />
                        </svg>
                        Histogrammes - Comparaison des distributions vélo, transport en commun et sans transport selon
                        le nombre de communes
                    </h5>
                </div>
                <div class="card-body">
                    <img src="{{ url_for('static', filename='images/Comparaison_distribution.png') }}"
                        alt="Histogrammes" class="img-fluid">
                </div>
            </div>
        </div>
        <div class="col-12">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0 d-flex align-items-center gap-2">
                        <svg class="fib-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <line x1="10" y1="90" x2="90" y2="90" stroke="currentColor" stroke-width="1.5"
                                opacity="0.3" />
                            <line x1="10" y1="90" x2="10" y2="10" stroke="currentColor" stroke-width="1.5"
                                opacity="0.3" />
                            <rect x="20" y="70" width="8" height="20" fill="currentColor" opacity="0.8" />
                            <rect x="35" y="50" width="8" height="40" fill="currentColor" opacity="0.8" />
                            <rect x="50" y="30" width="8" height="60" fill="currentColor" opacity="0.8" />
                            <rect x="65" y="40" width="8" height="50" fill="currentColor" opacity="0.8" />
                        </svg>
                        Bar Charts - Comparaison des distributions vélo, transport en commun et sans transport en détail
                        selon une vingtaine de communes
                    </h5>
                </div>
                <div class="card-body">
                    <img src="{{ url_for('static', filename='images/Comparaison_distribution_2.png') }}"
                        alt="Histogrammes" class="img-fluid">
                </div>
            </div>
        </div>
        <div class="col-12">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0 d-flex align-items-center gap-2">
                        <svg class="fib-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <line x1="10" y1="10" x2="90" y2="10" stroke="currentColor" stroke-width="1.5"
                                opacity="0.3" />
                            <line x1="10" y1="10" x2="10" y2="90" stroke="currentColor" stroke-width="1.5"
                                opacity="0.3" />
                            <path d="M 15 25 Q 25 35, 35 40 T 55 55 T 75 70 T 85 85" fill="none" stroke="currentColor"
                                stroke-width="3" stroke-linecap="round" />
                            <circle cx="15" cy="25" r="2" fill="currentColor" />
                            <circle cx="35" cy="40" r="2.5" fill="currentColor" />
                            <circle cx="55" cy="55" r="3" fill="currentColor" />
                            <circle cx="75" cy="70" r="2.5" fill="currentColor" />
                            <circle cx="85" cy="85" r="2" fill="currentColor" />
                        </svg>
                        Courbes d'Évolution de l'utilisation des transports (vélo / transport en commun) selon les âges
                    </h5>
                </div>
                <div class="card-body">
                    <img src="{{ url_for('static', filename='images/Evolution_usage_des_transports_par_classe_age.png') }}"
                        alt="Histogrammes" class="img-fluid">
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Comparaisons -->
<section id="comparaisons" class="mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Comparaisons</h2>
        <span class="text-muted" style="font-size: 0.875rem;">Par zone géographique</span>
    </div>
    <div class="row g-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Top 5 Communes - Mobilité Verte</h5>
                </div>
                <div class="card-body">
                    {% if top_communes %}
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead>
                                    <tr>
                                        <th>Commune</th>
                                        <th>Mobilité Verte</th>
                                        <th>Temps Trajet</th>
                                        <th>Taux Vélo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for commune in top_communes[:5] %}
                                    <tr>
                                        <td><strong>{{ commune.get('LIBGEO', commune.get('Commune', 'N/A')) }}</strong></td>
                                        <td>{{ "%.1f"|format(commune.get('green_mobility_index', 0)) }}%</td>
                                        <td>{{ "%.1f"|format(commune.get('avg_commute_time', 0)) }} min</td>
                                        <td>{{ "%.1f"|format(commune.get('bike_usage_rate', 0)) }}%</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted">Aucune donnée disponible</p>
                    {% endif %}
                    <a href="{{ url_for('mobilite.communes') }}" class="btn btn-primary mt-3">Voir toutes les communes →</a>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Top 5 Régions - Mobilité Verte</h5>
                </div>
                <div class="card-body">
                    {% if top_regions %}
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead>
                                    <tr>
                                        <th>Région</th>
                                        <th>Mobilité Verte</th>
                                        <th>Temps Trajet</th>
                                        <th>Taux Vélo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for region in top_regions %}
                                    <tr>
                                        <td><strong>{{ region.get('Région', region.get('REGION', 'N/A')) }}</strong></td>
                                        <td>{{ "%.1f"|format(region.get('green_mobility_index', 0)) }}%</td>
                                        <td>{{ "%.1f"|format(region.get('avg_commute_time', 0)) }} min</td>
                                        <td>{{ "%.1f"|format(region.get('bike_usage_rate', 0)) }}%</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted">Aucune donnée disponible</p>
                    {% endif %}
                    <a href="{{ url_for('mobilite.regions') }}" class="btn btn-primary mt-3">Voir toutes les régions →</a>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}